<xhtml:html xmlns:xforms="http://www.w3.org/2002/xforms"
    xmlns:f="http://orbeon.org/oxf/xml/formatting" xmlns:xhtml="http://www.w3.org/1999/xhtml"
    xmlns:xxforms="http://orbeon.org/oxf/xml/xforms" xmlns:widget="http://orbeon.org/oxf/xml/widget"
    xmlns:ev="http://www.w3.org/2001/xml-events" xmlns:xs="http://www.w3.org/2001/XMLSchema"
    xmlns:xbl="http://www.w3.org/ns/xbl" xmlns:xxbl="http://orbeon.org/oxf/xml/xbl"
    xmlns:fr="http://orbeon.org/oxf/xml/form-runner">

    <xhtml:head>
        <xhtml:title>XHTML Editor</xhtml:title>
        <xforms:model xmlns:xforms="http://www.w3.org/2002/xforms">
            <xforms:instance>
                <instance>
                    <relevant>false</relevant>
                    <readonly>false</readonly>
                    <text>toto</text>
                </instance>
            </xforms:instance>
            <xforms:bind nodeset="text" relevant="../relevant = 'true'" readonly="../readonly = 'true'"/>
        </xforms:model>

        <xhtml:link type="text/css" rel="stylesheet" href="/ops/yui/logger/assets/logger.css"/>
        <xhtml:script type="text/javascript" src="/ops/yui/logger/logger.js"/>
        <xhtml:script type="text/javascript" src="/ops/yui/yuitest/yuitest.js"/>
        <xhtml:script type="text/javascript">
            <![CDATA[
            YAHOO.tool.TestRunner.add(new YAHOO.tool.TestCase({

                name: "XHTML Editor",

                /**
                 * We started adding disabled="" on form controls in non-relevant sections, so those controls wouldn't
                 * "steal" the focus. However this causes a problem for the HTML area: if the <textarea> is disabled,
                 * the RTE is initialized in a disabled mode by YUI. To fix this, when the RTE become relevant, we must
                 * call the RTE code to make it non-disabled, otherwise the RTE shows as read-only. This checks that the
                 * RTE is not in read-only mode after it becomes relevant.
                 */
                testBecomesRelevant: function() {
                    ORBEON.util.Test.executeCausingAjaxRequest(this, function() {
                        YAHOO.util.UserAction.click("toggle-relevant");
                    }, function() {
                        var maskedEditor = YAHOO.util.Dom.getElementsByClassName("yui-editor-masked", null, "html-editor");
                        YAHOO.util.Assert.areEqual(0, maskedEditor.length, "editor should not be masked");
                    });
                }
            }));

            ORBEON.xforms.Events.orbeonLoadedEvent.subscribe(function() {
                if (parent && parent.TestManager) {
                    parent.TestManager.load();
                } else {
                    new YAHOO.tool.TestLogger();
                    YAHOO.tool.TestRunner.run();
                }
            });
            ]]>
        </xhtml:script>
    </xhtml:head>
    <xhtml:body>
        <xforms:group>
            <xforms:trigger appearance="minimal" id="toggle-relevant">
                <xforms:label>Toggle relevant</xforms:label>
                <xforms:setvalue ev:event="DOMActivate" ref="relevant" value="if (. = 'true') then 'false' else 'true'"/>
            </xforms:trigger> |
            <xforms:trigger appearance="minimal">
                <xforms:label>Toggle readonly</xforms:label>
                <xforms:setvalue ev:event="DOMActivate" ref="readonly" value="if (. = 'true') then 'false' else 'true'"/>
            </xforms:trigger>
            <xforms:textarea ref="text" mediatype="text/html" id="html-editor"/>
        </xforms:group>
    </xhtml:body>
</xhtml:html>
